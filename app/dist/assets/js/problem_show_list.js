var app=angular.module("myApp",[]),requestProblem=requestHost+"Problem/",requestProject=requestHost+"Project/";app.config(["$locationProvider",function(e){e.html5Mode({enabled:!0,requireBase:!1})}]),app.controller("userCtrl",["$scope","$http","$location",function(e,r,a){function t(a,t,s){e.queryParams.start=e.start,e.queryParams.count=e.count,e.queryParams.keyword=e.keyword,r.get(requestProblem+"ProblemInfo_list",{params:e.queryParams}).then(function(r){0==r.data.length?o():Array.prototype.push.apply(e.users,r.data)},function(e){console.log(e)})}if(a.search().company_id){e.queryParams={},e.queryParams.company_id=a.search().company_id,e.queryParams.project_id=a.search().project_id,e.queryParams.subproject_id=a.search().subproject_id,e.from_ipm=a.search().ipm,e.projectList=[{id:0,name:"全部"}],e.showProjectName="全部",r.get(requestProject+"projectInfo_list",{params:{company_id:e.queryParams.company_id}}).then(function(r){Array.prototype.push.apply(e.projectList,r.data)},function(e){console.log(e)}),e.selectProject=function(r){0==r.id?(delete e.queryParams.project_id,delete e.queryParams.subproject_id):e.queryParams.project_id=r.id,e.showProjectName=r.name,e.search()},e.selectSubproject=function(r){0==r.id?delete e.queryParams.subproject_id:e.queryParams.subproject_id=r.id,e.showSubprojectName=r.name,e.search()};e.$watch("queryParams.project_id",function(){e.subprojectList=[{id:0,name:"全部"}],e.showSubprojectName="全部",e.queryParams.project_id&&(r.get(requestProject+"project_name",{params:{project_id:e.queryParams.project_id}}).then(function(r){0!=r.data.length?e.showProjectName=r.data[0].name:alert("总项目不存在！")},function(e){console.log(e)}),r.get(requestProject+"subprojectInfo_list",{params:{project_id:e.queryParams.project_id}}).then(function(r){if(Array.prototype.push.apply(e.subprojectList,r.data),e.queryParams.subproject_id)for(var a=0;a<r.data.length;++a)if(r.data[a].id==e.queryParams.subproject_id)return void(e.showSubprojectName=r.data[a].name)},function(e){console.log(e)}))});e.problemChangerList=[],e.problemCreatorList=[],e.changer_id=e.queryParams.changer_id,e.changer_name=e.queryParams.changer_name,delete e.queryParams.changer_name,void 0==e.queryParams.changer_id&&(e.changer_name="全部",r.get(requestProblem+"problemuser_list",{params:{company_id:e.queryParams.company_id}}).then(function(r){Array.prototype.push.apply(e.problemChangerList,r.data.changer)},function(e){console.log(e)})),e.creator_id=e.queryParams.creator_id,e.creator_name=e.queryParams.creator_name,delete e.queryParams.creator_name,void 0==e.queryParams.creator_id&&(e.creator_name="全部",r.get(requestProblem+"problemuser_list",{params:{company_id:e.queryParams.company_id}}).then(function(r){Array.prototype.push.apply(e.problemCreatorList,r.data.creator)},function(e){console.log(e)})),e.showChanger=function(r){0==r?(e.changer_name="全部",delete e.queryParams.changer_id):(e.queryParams.changer_id=r.changer_id,e.changer_name=r.changer_nickname),e.search()},e.showCreator=function(r){0==r?(e.creator_name="全部",delete e.queryParams.creator_id):(e.queryParams.creator_id=r.creator_id,e.creator_name=r.creator_nickname),e.search()},e.alert={},e.dataToggle="modal",e.users=[],e.start=0,e.count=20,e.keyword;var o=e.$watch("start",t);e.search=function(){o(),e.start=0,e.users=[],o=e.$watch("start",t)},e.detailUser={},e.detailIndex,e.setDetailUser=function(r,a){e.detailUser=angular.copy(a),e.detailIndex=r};var s=["全部","待解决","","已解决"];e.selectedState="全部",e.showProblemState=function(r){e.selectedState=s[r],0==r?delete e.queryParams.state:e.queryParams.state=r,e.search()},e.prjState_str=["全部","底图深化","配模阶段","制图阶段","预拼装","现场施工"],e.selectedPrjState="全部",e.showProblemPrjState=function(r){e.selectedPrjState=e.prjState_str[r],0==r?delete e.queryParams.prjState:e.queryParams.prjState=r,e.search()},e.subtype_str=["全部","楼板","梁板","墙板","飘台","楼梯","背楞","其他"],e.selectedSubtype="全部",e.showProblemType=function(r){e.selectedSubtype=e.subtype_str[r],0==r?delete e.queryParams.subtype_id:e.queryParams.subtype_id=r,e.search()},e.problemGrade_str=["全部","一级","二级","三级","四级","五级"],e.selectedProblemGrade="全部",e.showProblemGrade=function(r){e.selectedProblemGrade=e.problemGrade_str[r],0==r?delete e.queryParams.problemGrade:e.queryParams.problemGrade=e.problemGrade_str[r],e.search()},e.showImg=function(e){execAsync(JSON.stringify({functionName:"ShowImage",functionParams:{args:{url:e}},invokeAsCommand:!1}),function(e){console.log(e)},function(e){console.log(e)})}}else alert("喂，你是哪个公司的？")}]);